<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" >
<head>	
  <!-- This site is based on the Auguste template designed and coded [Gian Carlo Franco](www.carlofranco.ca). Antique variation by Brett Terpstra. -->
	<title>Antique 1.5 for Safari Reader</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="readability-verification" content="rbPZmz5uZnPmEg4UNerszNZUcyxN2aHQL7XcRewB">
	<meta name="description" content="" />
	<meta name="keywords" content="" />
  <link rel='me' href='http://www.google.com/profiles/circlesixdesign' />
	<meta name="robots" content="all" />
	<meta name="robots" content="index, follow" />
	<meta name="revisit-after" content="7 days" />
	<meta name="version" content="1.0" />
	<meta name="copyright" content="" />
	<link rel="icon" type="image/vnd.microsoft.icon" href="/favicon.ico" />
	<link rel="apple-touch-icon" href="/favicon.png"/>
	<link rel="alternate" type="application/atom+xml" title="brettterpstra.dev RSS Feed" href="/feed.xml" />
	<!-- CSS -->
	<link rel="stylesheet" href="/css/style.css" media="screen" type="text/css"/>
	<link rel="stylesheet" href="/css/monokai.css" media="screen" type="text/css"/>
	<!-- <link rel="stylesheet" href="/css/screen.min.css" media="screen" type="text/css"/> -->
	<!--[if IE 6]>
	<link href="/css/ie.css" rel="stylesheet" media="screen" type="text/css" />
	<![endif]-->
</head>
<body class="blog single-post">
	<div id="header-wrapper">
		<div id="header">
			<h1>
				<a id="logo" href="/" title="Brett Terpstra">Brett Terpstra</a>
			</h1>
			<div id="nav">
	<ul>
		<li><a class="current home" href="/">Home</a></li>
		<li><a href="/categories/">Categories</a></li>
		<li><a href="/tags/">Tags</a></li>
		<li><a href="/contact/">Contact</a></li>
    <!-- <li><a href="#">Projects</a></li> -->
		<li><a href="/about/">About</a></li>
	</ul>
</div><!-- end: #nav -->
		</div><!-- end: #header -->
	</div><!-- end: #header-wrapper-->
	<div id="content-wrapper">
		<div id="main-container" class="clearfix">
			<div id="content">
	<div class="post">
		<div class="post-meta">
			<span class="date">13 Jun 2010 | </span>
			<span class="num-comments"><a href="#comments"><span class="responses-number">0</span> Comments</a> | </span>
			<span class="categories">
				Category: <a href="/categories/code">Code</a>
			</span>
		</div>
		<h1 class="post-title"><a href="#">Antique 1.5 for Safari Reader</a></h1>
		
<p><strong>There is a new version of Antique available! <a href="http://brettterpstra.dev/2010/06/17/antique-1-6-final-release/">Check out version 1.6</a>!</strong></p>

<p>&lt;a href=&rdquo;[download id=&rdquo;13&rdquo; format=&rdquo;2&rdquo;]&rdquo; title=&rdquo;Download Antique 1.6&rdquo;&gt;Version <del datetime="2010-06-18T16:36:40+00:00">1.5</del> <ins datetime="2010-06-18T16:36:40+00:00">1.6</ins> of Antique&lt;/a&gt; (<a href="http://brettterpstra.dev/2010/06/12/safari-reader-antique-hack/">originally posted here</a>) is officially available for download. Here&rsquo;s what&rsquo;s new!</p>

<hr style="visibility:hidden;clear:both" />

<ul>
  <li><a href="http://brettterpstra.dev/wp-content/uploads/2010/06/Antique1.5.1screenshot.jpg"><img src="http://brettterpstra.dev/wp-content/uploads/2010/06/Antique1.5.1screenshot-150x150.jpg" alt="" title="Antique1.5.1screenshot" width="150" height="150" class="alignright size-thumbnail wp-image-609" /></a> <strong>jQuery:</strong> added the <a href="http://jquery.com/">jQuery</a> library via Google&rsquo;s Ajax API to make some of the other additions much easier to implement.</li>
  <li><strong>Colorbox:</strong> links to images are automatically opened in a &ldquo;lightbox&rdquo; so you don&rsquo;t have to leave the page. Uses jQuery <a href="http://colorpowered.com/colorbox/">Colorbox</a> and automatically applies the effect to links ending in &lsquo;.jpg&rsquo; or &lsquo;.png&rsquo;.</li>
  <li><strong>Widon&rsquo;t:</strong> headlines and paragraphs have a widon&rsquo;t function applied to them, preventing &ldquo;widows&rdquo; (short words alone on a line). This was mostly annoying me in the top-level headings of the page, but it&rsquo;s a nice touch throughout. It ignores words longer than 8 characters. They&rsquo;ll do just fine on their own.</li>
  <li><strong>New HUD buttons:</strong> in addition to the Evernote web clipper button in the floating HUD, there are new buttons for <a href="http://www.devon-technologies.com/products/devonthink/devonthink2.html">DEVONthink</a>, <a href="http://delibarapp.com/">Delibar</a> and <a href="http://www.celmaro.com/webbla/">Webbla</a>. These are mostly to show how to pull it off, and are easily edited. See the instructions below to remove buttons from the HUD.</li>
  <li><strong>Pass text selections:</strong> unlike using bookmarklets, clicking on a HUD icon makes you lose your text selection. Any service that accepts a selection as a note or description (Evernote, DEVONthink, Webbla, etc.) won&rsquo;t normally work. By storing the selected text in an HTML5 sessionStorage key every time your mouse enters the HUD, Antique is able to pass what <em>was</em> selected before you clicked the button. <em>Still working on making this function with Evernote.</em></li>
  <li><a href="http://brettterpstra.dev/wp-content/uploads/2010/06/antiqueColorBoxScreenshot.jpg"><img src="http://brettterpstra.dev/wp-content/uploads/2010/06/antiqueColorBoxScreenshot-150x150.jpg" alt="" title="Antique with ColorBox" width="150" height="150" class="alignright size-thumbnail wp-image-595" /></a> <strong>Smarter image resizing:</strong> when you load a page, Antique shrinks the larger images. It&rsquo;s smarter now, though: wide, centered images are only reduced slightly and left centered, and any floated images that are reduced (and aren&rsquo;t already linked somewhere) are now linked to the full size version of themselves, which will display in-page using Colorbox. Floated images also have bottom margin and clear:left applied to them to prevent horizontal stacking when images are close to each other in the layout.</li>
  <li><strong><em>Minor Update:</em></strong> <em>(version 1.5.1)</em> I just swapped out Crimson Text for OFL Sorts Mill Goudy TT, primarily because I like the quotation marks much better. I also added hanging quotes (image-based) to blockquotes, and improved code blocks and bulleted lists wrapped around images.</li>
</ul>

<h3 id="installation">Installation</h3>

<p>If you want to try out the style, &lt;a href=&rdquo;[download id=&rdquo;13&rdquo; format=&rdquo;2&rdquo;]&rdquo;&gt;download it here&lt;/a&gt; and open the archive. Inside you&rsquo;ll find a file called Reader.html. The file you&rsquo;re going to replace (back it up somewhere safe first) is <code>/Applications/Safari.app/Contents/Resources/Reader.html</code>. If you don&rsquo;t know how to do this from Terminal, you can just do it in Finder: go to your Applications folder and locate Safari, then right click on it and choose &ldquo;Show Package Contents.&rdquo; That will open a new window with the inner workings of Safari inside it. Open the folder called Contents, and then the Resources folder inside of that. Locate the file Reader.html and drag it out to your desktop (that&rsquo;s your original, keep it safe). Then drag the new Reader.html file you downloaded into the Resources folder. Restart Safari and try it out!</p>

<p>There are lots of minor efficiency and style tweaks, but those are the major changes. If you&rsquo;re interested in modifying the HUD (removing unnecessary buttons), read on&hellip;</p>

<!--more-->

<h3 id="removing-hud-buttons">Removing HUD buttons</h3>

<p>This part is a cinch, even if you don&rsquo;t know anything about Javscript or HTML. The HUD buttons are in the HTML body section of the Reader.html file, and you can just edit them out in a text editor. If you open the file (Reader.html) in a your editor of choice (as plain text, not rich text), and scroll all the way to the bottom, you&rsquo;ll see a series of &ldquo;<code>&lt;button id="hud... &gt;</code>&rdquo; lines. It will be pretty obvious what each one is for, and you can simply comment out or delete the lines for buttons you don&rsquo;t need. Antique will automatically resize and reposition the HUD based on the number of buttons in it, so that&rsquo;s all you have to worry about.</p>

<h3 id="adding-hud-buttons">Adding HUD buttons</h3>

<p>Adding buttons is a different story, depending on what you want the button to do. So far, I&rsquo;ve mostly been converting existing bookmarklets. You can set the function to call right in the button definition (just copy an existing button and edit it), then add the appropriate function to the script section above. Note that any bookmarklet that uses <code>window.location</code>, <code>location.href</code> or any means of getting the page title attribute are going to break. Reader overrides all of that, but thankfully, it stores the info in an object called ReaderJS. You can access the original page url with <code>ReaderJS.originalURL</code> and the title with <code>ReaderJS.displayTitle</code>. Those two make it pretty easy to cover 90% of bookmarklets you&rsquo;d want to use.</p>

<p>I&rsquo;m including most external javascript plugins and libraries directly in the html page. Standard rules don&rsquo;t apply, this is all being served locally and the fewer files you have to keep track of, the easier it is to distribute. If your needs are different, you can reference external files in the <code>Safari.app/Contents/Resources</code> folder with <code>safari-resource:/filename.ext</code>, where filename.ext is the name of the file.</p>

<p>Antique handles the resizing of the HUD automatically, but if you&rsquo;re doing it from scratch you&rsquo;ll need to adjust the width and left-margin of #hud in the css section. The buttons are 48x48px PNG files, with the icon occupying approximately 36x36px of that space. White and transparent pixels only, if you want to fit the aesthetic, and the &ldquo;inactive&rdquo; version should be saved at about 70% opacity. I&rsquo;ve been encoding all of my PNG files in base64 and including them inline in the CSS to make it easier to distribute, but you can reference them as mentioned above.</p>

<p>You also can&rsquo;t use <code>document.location</code> when Reader.html is loaded, so most bookmarklets need to be modified. You can use <code>window.open</code> and immediately close the new window, like this:</p>

<p>&lt;div markdown=0&gt;</p>
<pre><code>
function sendToWebbla() {
	var wlWindow = window.open(&#x27;webbla:url=&#x27;+encodeURIComponent(ReaderJS.originalURL)+&#x27;&amp;mode=modify&amp;title=&#x27;+encodeURIComponent(ReaderJS.displayTitle))+&#x27;&amp;textSelection=&#x27;+encodeURIComponent(sessionStorage.getItem(&#x27;textSelection&#x27;));
	wlWindow.close();
	self.focus();
}
</code></pre>
<p>&lt;/div&gt;</p>

<p>I have the <code>self.focus()</code> in there because I have <a href="http://haoli.dnsalias.com/Saft/index.html">Saft</a> running and restoring focus to the last active tab, which somehow is missing and leaving me on the wrong tab when I execute the above sequence. So this just brings me back to the right tab. When it runs, you can just <em>barely</em> see that it&rsquo;s even opening a new window/tab. Should be pretty seamless for most folks.</p>

<p>I think that covers the process in a general sense. Each button I&rsquo;ve added has had its own quirks and issues, so it would take a lot longer to detail every possible problem you&rsquo;d run in to.</p>

<p>[download id=&rdquo;13&rdquo; format=&rdquo;1&rdquo;]</p>

<hr style="visibility:hidden;clear:both" />


	</div>
	<div class="nextprev clearfix">
		<a class="prev" href="/safari-reader-antique-hack"><span>Safari Reader Antique hack</span><br/>&larr; Previous Entry</a>
		<a class="next" href="/ampersands-javascript"><span>Ampersands & Javascript</span><br/>Next Entry &rarr;</a>
	</div>
	<div class="related-posts section">
		<h3 class="uppercase-title">Related Posts</h3>
		<ol>
			
				<li><a href="/oft-bash-function-for-opening-a-specific-filetype">oft: Bash function for opening a specific filetype</a></li>
			
				<li><a href="/otask-cli-for-omnifocus">OTask: CLI for OmniFocus</a></li>
			
				<li><a href="/web-excursions-june-28-2011-june-30-2011">Web excursions: June 28, 2011 - June 30, 2011</a></li>
			
				<li><a href="/web-excursions-june-15-2011-june-23-2011">Web excursions: June 15, 2011 - June 23, 2011</a></li>
			
				<li><a href="/a-bash-function-for-markdown-bloggers">A Bash function for Markdown bloggers</a></li>
			
		</ol>
	</div><!-- end: related-posts -->
	<div id="comments" class="section">
		<div id="num-responses"><span class="responses-number">0</span> Responses. <a href="#comments">Add Yours!</a></div>
		<h3>Discussion</h3>
		<div id="disqus_thread"></div>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
		<div id="disqus_thread" name="#comments">
		</div>
	</div>
</div><!-- end: #content-->
<div id="sidebar">
	<div id="side-intro" class="section">
	<div id="side-description">
		<p><strong>Brett Terpstra</strong> is Tech Lead for the blogs of AOL Tech. In his free time, he performs mad science with code and shares the results with whoever is curious.</p>
	</div>
	<div id="update-icons">
		<ul>
			<li class="rss"><a href="/feed.xml" title="Grab the Feed">RSS</a></li>
			<li class="twitter"><a class="twitter-anywhere-user" href="http://www.twitter.com/ttscoff">@ttscoff</a></li>
		</ul>
	</div>
</div>
	<div id="side-tabs">
	<ul class="tabnav clearfix">
		<li class="active"><a href="#ui-tabs-1">Recent</a></li>
		<li><a href="#ui-tabs-2">Categories</a></li>
		<li><a href="#ui-tabs-3">Projects</a></li>
	</ul>
	<div id="ui-tabs-1" class="tab-content">
		<ul>
			
				<li><a href="//oft-bash-function-for-opening-a-specific-filetype/" title="oft: Bash function for opening a specific filetype">oft: Bash function for opening a specific filetype</a></li>
			
				<li><a href="//otask-cli-for-omnifocus/" title="OTask: CLI for OmniFocus">OTask: CLI for OmniFocus</a></li>
			
				<li><a href="//web-excursions-june-28-2011-june-30-2011/" title="Web excursions: June 28, 2011 - June 30, 2011">Web excursions: June 28, 2011 - June 30, 2011</a></li>
			
				<li><a href="//web-excursions-june-15-2011-june-23-2011/" title="Web excursions: June 15, 2011 - June 23, 2011">Web excursions: June 15, 2011 - June 23, 2011</a></li>
			
				<li><a href="//a-bash-function-for-markdown-bloggers/" title="A Bash function for Markdown bloggers">A Bash function for Markdown bloggers</a></li>
			
		</ul>
		<a href="/2011/" class="btn-more">more &raquo;</a>
	</div>
	<div id="ui-tabs-2" class="tab-content">
		<ul>
			
				<li><a href="/categories/misc">Misc</a></li>
			
				<li><a href="/categories/blog">Blog</a></li>
			
				<li><a href="/categories/code">Code</a></li>
			
				<li><a href="/categories/bookmarks">Bookmarks</a></li>
			
				<li><a href="/categories/music">Music</a></li>
			
				<li><a href="/categories/write">Write</a></li>
			
		</ul>
		<a href="/categories/" class="btn-more">more &raquo;</a>
	</div>
	
  
  <div id="ui-tabs-3" class="tab-content">
  	<a href="#" class="btn-more">more &raquo;</a>
  	
  	</ul>
  </div>
  
</div>
	<div id="popular-tags" class="section">	
	<h2 class="section-title">Topics</h2>
	<ul>
		
			<li><a href="/tags/safari" name="safari">safari</a></li>
		
			<li><a href="/tags/jquery" name="jquery">jquery</a></li>
		
			<li><a href="/tags/safari-5" name="safari-5">safari 5</a></li>
		
			<li><a href="/tags/hacks" name="hacks">hacks</a></li>
		
			<li><a href="/tags/antique" name="antique">antique</a></li>
		
	</ul>
</div>
</div><!-- end: #sidebar -->
<script type="text/javascript">
    var disqus_shortname = 'brettterpstra';
    var disqus_identifier = '';
    var disqus_url = '/antique-1-5-for-safari-reader';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

		</div><!-- end: #main-container -->
	</div><!-- end: #content-wrapper -->
	<div id="footer-wrapper">
	<div id="footer">
		<div id="colophon">
			<p>Copyright &copy; 2011 Brett Terpstra. All Rights Reserved.</p>
		</div>
	</div><!-- end: #footer -->
</div><!-- end: #footer-wrapper -->
	<!-- Javascript -->
	<script src="/js/jquery.min.js" type="text/javascript"></script>
	<script src="/js/ui.tabs.min.js" type="text/javascript"></script>
	<script src="/js/scripts.js" type="text/javascript"></script>
	
  <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'brettterpstra'; // required: replace example with your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function () {
          var s = document.createElement('script'); s.async = true;
          s.type = 'text/javascript';
          s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
          (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
      }());
  </script>
</body>
</html>